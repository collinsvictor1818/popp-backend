# AWS EventBridge Integration

This document outlines how to integrate with the Popp AI system using AWS EventBridge for event-driven communication. EventBridge allows you to build scalable, event-driven applications by routing events between various AWS services, your own applications, and SaaS applications.

## Overview

The Popp AI system can act as both an event source and an event target within EventBridge. This enables loose coupling between services and facilitates real-time data flow.

*   **Event Sources:** Events generated by the Popp AI system (e.g., new conversation created, conversation status updated) can be published to an EventBridge event bus.
*   **Event Patterns:** You can define rules with event patterns to match specific events of interest.
*   **Targets:** Matched events can be routed to various AWS services (e.g., Lambda functions, SQS queues, SNS topics) or external endpoints for further processing.
*   **Event Bus Configuration:** A custom event bus can be used to centralize events from the Popp AI system.

## Event Structure

Events published by the Popp AI system to EventBridge will follow a standard structure. While specific `detail` content will vary by event type, the general format will be:

```json
{
  "version": "0",
  "id": "uuid",
  "detail-type": "PoppAI.ConversationEvent",
  "source": "com.poppai.backend",
  "account": "AWS_ACCOUNT_ID",
  "time": "YYYY-MM-DDTHH:MM:SSZ",
  "region": "aws-region",
  "resources": [],
  "detail": {
    "eventType": "ConversationCreated" | "ConversationStatusUpdated",
    "conversationId": "uuid",
    "candidateId": "uuid",
    "jobId": "uuid",
    "status": "CREATED" | "ONGOING" | "COMPLETED",
    "timestamp": "YYYY-MM-DDTHH:MM:SSZ",
    "//": "Other relevant data based on eventType"
  }
}
```

**Example: `ConversationCreated` Event**

```json
{
  "version": "0",
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "detail-type": "PoppAI.ConversationEvent",
  "source": "com.poppai.backend",
  "account": "123456789012",
  "time": "2025-09-20T10:00:00Z",
  "region": "us-east-1",
  "resources": [],
  "detail": {
    "eventType": "ConversationCreated",
    "conversationId": "conv-123",
    "candidateId": "cand-456",
    "jobId": "job-789",
    "status": "CREATED",
    "timestamp": "2025-09-20T10:00:00Z"
  }
}
```

## Configuration

To integrate with EventBridge:

1.  **Create an Event Bus:** You can use the default event bus or create a custom one for Popp AI events.
2.  **Define Rules:** Create EventBridge rules that specify which events to capture based on `source`, `detail-type`, and `detail` content.
    *   **Example Rule (Match all Popp AI Conversation Events):**
        ```json
        {
          "source": ["com.poppai.backend"],
          "detail-type": ["PoppAI.ConversationEvent"]
        }
        ```
    *   **Example Rule (Match `ConversationCreated` Events):**
        ```json
        {
          "source": ["com.poppai.backend"],
          "detail-type": ["PoppAI.ConversationEvent"],
          "detail": {
            "eventType": ["ConversationCreated"]
          }
        }
        ```
3.  **Configure Targets:** For each rule, specify one or more targets (e.g., AWS Lambda, SQS, SNS) that will process the matched events.
4.  **Permissions:** Ensure the Popp AI system has the necessary IAM permissions to `PutEvents` to the EventBridge bus, and that your targets have permissions to be invoked by EventBridge.
